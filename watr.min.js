const e=["unreachable","nop","block","loop","if","else",,,,,,"end","br","br_if","br_table","return","call","call_indirect",,,,,,,,,"drop","select",,,,,"local.get","local.set","local.tee","global.get","global.set",,,,"i32.load","i64.load","f32.load","f64.load","i32.load8_s","i32.load8_u","i32.load16_s","i32.load16_u","i64.load8_s","i64.load8_u","i64.load16_s","i64.load16_u","i64.load32_s","i64.load32_u","i32.store","i64.store","f32.store","f64.store","i32.store8","i32.store16","i64.store8","i64.store16","i64.store32","memory.size","memory.grow","i32.const","i64.const","f32.const","f64.const","i32.eqz","i32.eq","i32.ne","i32.lt_s","i32.lt_u","i32.gt_s","i32.gt_u","i32.le_s","i32.le_u","i32.ge_s","i32.ge_u","i64.eqz","i64.eq","i64.ne","i64.lt_s","i64.lt_u","i64.gt_s","i64.gt_u","i64.le_s","i64.le_u","i64.ge_s","i64.ge_u","f32.eq","f32.ne","f32.lt","f32.gt","f32.le","f32.ge","f64.eq","f64.ne","f64.lt","f64.gt","f64.le","f64.ge","i32.clz","i32.ctz","i32.popcnt","i32.add","i32.sub","i32.mul","i32.div_s","i32.div_u","i32.rem_s","i32.rem_u","i32.and","i32.or","i32.xor","i32.shl","i32.shr_s","i32.shr_u","i32.rotl","i32.rotr","i64.clz","i64.ctz","i64.popcnt","i64.add","i64.sub","i64.mul","i64.div_s","i64.div_u","i64.rem_s","i64.rem_u","i64.and","i64.or","i64.xor","i64.shl","i64.shr_s","i64.shr_u","i64.rotl","i64.rotr","f32.abs","f32.neg","f32.ceil","f32.floor","f32.trunc","f32.nearest","f32.sqrt","f32.add","f32.sub","f32.mul","f32.div","f32.min","f32.max","f32.copysign","f64.abs","f64.neg","f64.ceil","f64.floor","f64.trunc","f64.nearest","f64.sqrt","f64.add","f64.sub","f64.mul","f64.div","f64.min","f64.max","f64.copysign","i32.wrap_i64","i32.trunc_f32_s","i32.trunc_f32_u","i32.trunc_f64_s","i32.trunc_f64_u","i64.extend_i32_s","i64.extend_i32_u","i64.trunc_f32_s","i64.trunc_f32_u","i64.trunc_f64_s","i64.trunc_f64_u","f32.convert_i32_s","f32.convert_i32_u","f32.convert_i64_s","f32.convert_i64_u","f32.demote_f64","f64.convert_i32_s","f64.convert_i32_u","f64.convert_i64_s","f64.convert_i64_u","f64.promote_f32","i32.reinterpret_f32","i64.reinterpret_f64","f32.reinterpret_i32","f64.reinterpret_i64"],t={type:1,import:2,func:3,table:4,memory:5,global:6,export:7,start:8,elem:9,code:10,data:11},i={i32:127,i64:126,f32:125,f64:124,void:64,func:96,funcref:112},n={func:0,table:1,memory:2,global:3},s={"i32.load":4,"i64.load":8,"f32.load":4,"f64.load":8,"i32.load8_s":1,"i32.load8_u":1,"i32.load16_s":2,"i32.load16_u":2,"i64.load8_s":1,"i64.load8_u":1,"i64.load16_s":2,"i64.load16_u":2,"i64.load32_s":4,"i64.load32_u":4,"i32.store":4,"i64.store":8,"f32.store":4,"f64.store":8,"i32.store8":1,"i32.store16":2,"i64.store8":1,"i64.store16":2,"i64.store32":4};e.map(((t,i)=>e[t]=i));var l=e=>{let i={type:[],import:[],func:[],table:[],memory:[],global:[],export:[],start:[],elem:[],code:[],data:[]},n=[0,97,115,109,1,0,0,0];"string"==typeof e[0]&&"module"!==e[0]&&(e=[e]);for(let t in i){let n=[];for(let s of e)s[0]===t?f[t](s,i):n.push(s);e=n}for(let e in i){let s=i[e];if(s.importc&&(s=s.slice(s.importc)),!s.length)continue;let l=t[e],f=[];8!==l&&f.push(s.length);for(let e of s)f.push(...e);n.push(l,...h(f.length),...f)}return new Uint8Array(n)};const f={type([,e,t],n){"$"!==e[0]&&(t=e,e=null);let s,l,f=[],r=[],[o,...u]=t;if("func"===o){for(;"param"===u[0]?.[0];){let[,...e]=u.shift();"$"===e[0]?.[0]&&(f[e.shift()]=f.length),f.push(...e.map((e=>i[e])))}"result"===u[0]?.[0]&&(r=u.shift().slice(1).map((e=>i[e]))),l=[i.func,...h(f.length),...f,...h(r.length),...r],s=n.type.findIndex((e=>e.every(((e,t)=>e===l[t])))),s<0&&(s=n.type.push(l)-1)}return e&&(n.type[e]=s),[s,f,r]},func([,...t],n){let l=n.func.length,r=[],o=[];"$"===t[0]?.[0]&&(n.func[t.shift()]=l),"export"===t[0]?.[0]&&f.export([...t.shift(),["func",l]],n);let[u,p,_]=f.type([,["func",...t]],n);for(;"param"===t[0]?.[0]||"result"===t[0]?.[0];)t.shift();for(n.func.push([u]);"local"===t[0]?.[0];){let e,[,...n]=t.shift();"$"===n[0][0]&&(p[e=n.shift()]?m("Ambiguous name "+e):r[e]=p.length+r.length),r.push(...n.map((e=>i[e])))}const g=([t,...l])=>{1===t.length&&m(`Inline instructions are not supported \`${t+l.join("")}\``);let f,u=e[t],_=0,y=[],b=[];if(u>=69)_=u>=167||u<=159&&u>=153||u<=145&&u>=139||u<=123&&u>=121||u<=105&&u>=103||80==u||69==u?1:2;else if(u>=40&&u<=62){let e,i={align:s[t],offset:0};for(;l[0]?.[0]in i;)e=l.shift(),i[e[0]]=+e[1];b=[Math.log2(i.align),i.offset],_=u>=54?2:1}else if(u>=65&&u<=68)b=u<67?a(l.shift()):(67==u?c:d)(l.shift());else if(u>=32&&u<=34)b=h("$"===l[0]?.[0]?p[f=l.shift()]||r[f]:l.shift()),u>32&&(_=1);else if(35==u||36==u)b=h("$"===l[0]?.[0]?n.global[l.shift()]:l.shift()),u>35&&(_=1);else if(16==u)b=h(f="$"===l[0]?.[0]?n.func[l.shift()]:l.shift()),[,_]=n.type[n.func[f][0]];else if(17==u){let e=l.shift()[1];[,_]=n.type[e="$"===e[0]?n.type[e]:e],_++,b=h(e),b.push(0)}else if(63==u||64==u)b=[0],_=1;else if(4==u){o.push(u);let t,[,n]="result"===l[0][0]?l.shift():[,"void"];for(b=[i[n]],_=0,y.push(...g(l.shift())),"then"===l[0][0]?[,...t]=l.shift():t=l;t.length;)b.push(...g(t.shift()));o.pop(),o.push(e.else),"else"===l[0]?.[0]&&([,...t]=l.shift(),b.push(e.else,...t.flatMap(g))),o.pop(),b.push(e.end)}else if(26==u||15==u||11==u)_=1;else if(27==u)_=3;else if(2==u||3==u){o.push(u),"$"===l[0]?.[0]&&(o[l.shift()]=o.length);let[,t]="result"===l[0]?.[0]?l.shift():[,"void"];for(b=[i[t]];l.length;)b.push(...g(l.shift()));b.push(e.end),o.pop()}else if(12==u||13==u)b=h("$"===l[0]?.[0]?o.length-o[l.shift()]:l.shift()),_=13==u?1+(l.length>1):!!l.length;else if(14==u){for(b=[];!Array.isArray(l[0]);)f=l.shift(),b.push(...h("$"===f[0][0]?o.length-o[f]:f));b.unshift(...h(b.length-1)),_=1+(l.length>1)}else null==u&&m(`Unknown instruction \`${t}\``);for(l.length<_&&m(`Stack arguments are not supported at \`${t}\``);_--;)y.push(...g(l.shift()));return l.length&&m(`Too many arguments for \`${t}\`.`),[...y,u,...b]};let y=t.flatMap(g),b=r.reduce(((e,t)=>(t==e[e.length-1]?e[e.length-2]++:e.push(1,t),e)),[]);n.code.push([...h(y.length+2+b.length),...h(b.length>>1),...b,...y,e.end])},memory([,...e],t){if("$"===e[0][0]&&(t.memory[e.shift()]=t.memory.length),"import"===e[0][0]){let[i,...n]=e;return f.import([...i,["memory",...n]],t)}t.memory.push(u(e))},global([,...e],t){let n="$"===e[0][0]&&e.shift();n&&(t.global[n]=t.global.length);let[s,l]=e,f="mut"===s[0];t.global.push([i[f?s[1]:s],f,...r(l)])},table([,...e],t){let n="$"===e[0][0]&&e.shift();n&&(t.table[n]=t.table.length);let s=u(e);t.table.push([i[e.pop()],...s])},elem([,e,...t],i){i.elem.push([0,...r(e,i),...h(t.length),...t.flatMap((e=>h("$"===e[0]?i.func[e]:e)))])},export([,e,[t,i]],s){"$"===i[0]&&(i=s[t][i]),s.export.push([...o(e),n[t],...h(i)])},import([,e,t,i],s){let l,[r,...a]=i;if("func"===r){"$"===a[0]?.[0]&&(s.func[a.shift()]=s.func.length);let[e]=f.type([,["func",...a]],s);s.func.push(l=h(e)),s.func.importc=(s.func.importc||0)+1}else"memory"===r&&("$"===a[0][0]&&(s.memory[a.shift()]=s.memory.length),l=u(a));s.import.push([...o(e),...o(t),n[r],...l])},data([,e,t],i){i.data.push([0,...r(e,i),...o(t)])},start([,e],t){t.start.length||t.start.push(["$"===e[0]?t.func[e]:e])}},r=([t,i],n)=>"f"===t[0]?[e[t],...("f32"==t?c:d)(i),e.end]:[e[t],...a("$"===i[0]?n.global[i]:i),e.end],o=e=>{e='"'===e[0]?e.slice(1,-1):e;let t,i=[],n=0;for(;n<e.length;)t=e.charCodeAt(n++),i.push(...h(92===t?parseInt(e.slice(n,n+=2),16):t));return i.unshift(...h(i.length)),i},u=([e,t,i])=>isNaN(parseInt(t))?[0,...h(e)]:["shared"===i?3:1,...h(e),...h(t)];function a(e,t){t||(t=[],e=parseInt(e));let i=127&e,n=64&i;return 0==(e>>=7)&&0===n||-1===e&&0!==n?(t.push(i),t):(t.push(128|i),a(e,t))}const h=(e,t)=>{t||(t=[],e=parseInt(e));let i=127&e;return 0==(e>>>=7)?(t.push(i),t):(t.push(128|i),h(e,t))},p=new DataView(new BigInt64Array(1).buffer);function c(e,t,i){return~(i=e.indexOf("nan:"))?(t=parseInt(e.slice(i+4)),t|=2139095040,"-"===e[0]&&(t|=2147483648),p.setInt32(0,t)):(t="nan"===e||"+nan"===e||"-nan"===e?NaN:"inf"===e||"+inf"===e?1/0:"-inf"===e?-1/0:parseFloat(e),p.setFloat32(0,t)),[p.getUint8(3),p.getUint8(2),p.getUint8(1),p.getUint8(0)]}const _=0x8000000000000000n,g=0x7ff0000000000000n;function d(e,t,i){return~(i=e.indexOf("nan:"))?(t=BigInt(e.slice(i+4)),t|=g,"-"===e[0]&&(t|=_),p.setBigInt64(0,t)):(t="nan"===e||"+nan"===e||"-nan"===e?NaN:"inf"===e||"+inf"===e?1/0:"-inf"===e?-1/0:parseFloat(e),p.setFloat64(0,t)),[p.getUint8(7),p.getUint8(6),p.getUint8(5),p.getUint8(4),p.getUint8(3),p.getUint8(2),p.getUint8(1),p.getUint8(0)]}const m=e=>{throw Error(e)};var y=e=>{let t=0,i=[],n="";const s=()=>n&&(i.push(~n.indexOf("=")?n.split("="):n),n=""),l=()=>{for(let f,r;t<e.length;)if(f=e.charCodeAt(t),40===f)59===e.charCodeAt(t+1)?t=e.indexOf(";)",t)+2:(t++,(r=i).push(i=[]),l(),i=r);else if(59===f)t=e.indexOf("\n",t)+1;else if(f<=32)s(),t++;else{if(41===f)return s(),t++;n+=e[t++]}s()};return l(),i.length>1?i:i[0]},b=e=>(e="string"==typeof e?y(e):e,l(e));export{l as compile,b as default,y as parse};