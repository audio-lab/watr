const e=Object.fromEntries(["unreachable","nop","block","loop","if","else",,,,,,"end","br","br_if","br_table","return","call","call_indirect",,,,,,,,,"drop","select",,,,,"local.get","local.set","local.tee","global.get","global.set",,,,"i32.load","i64.load","f32.load","f64.load","i32.load8_s","i32.load8_u","i32.load16_s","i32.load16_u","i64.load8_s","i64.load8_u","i64.load16_s","i64.load16_u","i64.load32_s","i64.load32_u","i32.store","i64.store","f32.store","f64.store","i32.store8","i32.store16","i64.store8","i64.store16","i64.store32","memory.size","memory.grow","i32.const","i64.const","f32.const","f64.const","i32.eqz","i32.eq","i32.ne","i32.lt_s","i32.lt_u","i32.gt_s","i32.gt_u","i32.le_s","i32.le_u","i32.ge_s","i32.ge_u","i64.eqz","i64.eq","i64.ne","i64.lt_s","i64.lt_u","i64.gt_s","i64.gt_u","i64.le_s","i64.le_u","i64.ge_s","i64.ge_u","f32.eq","f32.ne","f32.lt","f32.gt","f32.le","f32.ge","f64.eq","f64.ne","f64.lt","f64.gt","f64.le","f64.ge","i32.clz","i32.ctz","i32.popcnt","i32.add","i32.sub","i32.mul","i32.div_s","i32.div_u","i32.rem_s","i32.rem_u","i32.and","i32.or","i32.xor","i32.shl","i32.shr_s","i32.shr_u","i32.rotl","i32.rotr","i64.clz","i64.ctz","i64.popcnt","i64.add","i64.sub","i64.mul","i64.div_s","i64.div_u","i64.rem_s","i64.rem_u","i64.and","i64.or","i64.xor","i64.shl","i64.shr_s","i64.shr_u","i64.rotl","i64.rotr","f32.abs","f32.neg","f32.ceil","f32.floor","f32.trunc","f32.nearest","f32.sqrt","f32.add","f32.sub","f32.mul","f32.div","f32.min","f32.max","f32.copysign","f64.abs","f64.neg","f64.ceil","f64.floor","f64.trunc","f64.nearest","f64.sqrt","f64.add","f64.sub","f64.mul","f64.div","f64.min","f64.max","f64.copysign","i32.wrap_i64","i32.trunc_f32_s","i32.trunc_f32_u","i32.trunc_f64_s","i32.trunc_f64_u","i64.extend_i32_s","i64.extend_i32_u","i64.trunc_f32_s","i64.trunc_f32_u","i64.trunc_f64_s","i64.trunc_f64_u","f32.convert_i32_s","f32.convert_i32_u","f32.convert_i64_s","f32.convert_i64_u","f32.demote_f64","f64.convert_i32_s","f64.convert_i32_u","f64.convert_i64_s","f64.convert_i64_u","f64.promote_f32","i32.reinterpret_f32","i64.reinterpret_f64","f32.reinterpret_i32","f64.reinterpret_i64"].flatMap(((e,t)=>e&&[[e,t]]))),t={type:1,import:2,func:3,table:4,memory:5,global:6,export:7,start:8,element:9,code:10,data:11},i={i32:127,i64:126,f32:125,f64:124,void:64,func:96,funcref:112},l={func:0,table:1,memory:2,global:3},o={"i32.load":4,"i64.load":8,"f32.load":4,"f64.load":8,"i32.load8_s":1,"i32.load8_u":1,"i32.load16_s":2,"i32.load16_u":2,"i64.load8_s":1,"i64.load8_u":1,"i64.load16_s":2,"i64.load16_u":2,"i64.load32_s":4,"i64.load32_u":4,"i32.store":4,"i64.store":8,"f32.store":4,"f64.store":8,"i32.store8":1,"i32.store16":2,"i64.store8":1,"i64.store16":2,"i64.store32":4},r=e=>{e|=0;const t=[];for(;;){const i=127&e;if(0==(e>>=7)&&0==(64&i)||-1===e&&0!=(64&i))return t.push(i),t;t.push(128|i)}};var f=e=>{let i,l={type:[],import:[],func:[],table:[],memory:[],global:[],export:[],start:[],element:[],code:[],data:[]};"string"==typeof e[0]&&(e=[e]);for(let t of e)s[t[0]]?.(t,l);return i=new Uint8Array([0,97,115,109,1,0,0,0,...Object.keys(l).flatMap((e=>{let i,o=l[e],r=o.length;return r?(i=o.flat(),i.unshift(t[e],i.length+1,r),i):[]}))]),console.log(l),i.section=l,i};const s={module([e,...t],i){for(let e of t)s[e[0]](e,i)},type([e,...t],l){let o="$"===t[0]?.[0]&&t.shift(),r=[],f=[],s=t[0];if("func"===s[0]){for(s.shift();"param"===s[0]?.[0];){let[e,...t]=s.shift();"$"===t[0]?.[0]&&(r[t.shift()]=r.length),r.push(...t.map((e=>i[e])))}"result"===s[0]?.[0]&&(f=s.shift().slice(1).map((e=>i[e])));let e=[i.func,r.length,...r,f.length,...f],t=l.type.findIndex((t=>t.every(((t,i)=>t===e[i]))));return t<0&&(t=l.type.push(e)-1),o&&(l.type[o]=t),[t,r,f]}},func([t,...l],f){let n=f.func.length,u=[];"$"===l[0]?.[0]&&(f.func[l.shift()]=n),"export"===l[0]?.[0]&&s.export([...l.shift(),["func",n]],f);let[_,c,d]=s.type([,["func",...l]],f);for(;"param"===l[0]?.[0]||"result"===l[0]?.[0];)l.shift();for(f.func.push([_]);"local"===l[0]?.[0];){let e,[t,...o]=l.shift();"$"===o[0][0]&&(c[e=o.shift()]&&a("Ambiguous name "+e),u[e]=c.length+u.length),o.forEach((e=>u.push(i[e])))}const p=t=>{let[i,...l]=t,s=[],[n,a]=i.split(".");if("store"===a){let e,t={align:[o[i]],offset:[0]};for(;l[0]?.[0]in t;)e=l.shift(),t[e[0]]=r(e[1]);s.push(...t.align,...t.offset)}else if("const"===a)s.push(...r(l.shift()));else if("local"===n){let e=l.shift();s.push(...r("$"===e[0]?c[e]||u[e]:e))}else if("call"===i){let e=l.shift();s.push(...r("$"===e[0]?f.func[e]:e))}else if("call_indirect"===i){let e=l.shift(),[t,i]=e;s.push(...r("$"===i[0]?f.type[i]:i),0)}return l=l.flatMap(p),[...l,e[i],...s]};l=l.flatMap((t=>Array.isArray(t)?p(t):[e[t]])),f.code.push([l.length+2+2*u.length,u.length,...u.flatMap((e=>[1,e])),...l,11])},memory([e,...t],i){let o=!1;"import"===t[0][0]&&(o=t.shift());let[r,f,s]=t,a=f?[1,+r,+f]:[0,+r];if(o){let[e,t,r]=o;i.import.push([t.length,...n.encode(t),r.length,...n.encode(r),l.memory,...a])}else i.memory.push(a)},global([e,t,i],l){l.global.push([])},table([e,...t],l){let o="$"===t[0][0]&&t.shift(),[r,f,s]=t,n=s?[1,+r,+f,i[s]]:[0,+r,i[f]];o&&(l.table[o]=l.table.length),l.table.push(n)},export([e,t,[i,o]],r){'"'===t[0]&&(t=t.slice(1,-1)),"$"===o[0]&&(o=r[i][o]),r.export.push([t.length,...n.encode(t),l[i],o])},import([e,t,i,l],o){s[l[0]]([l[0],["import",t,i],...l.slice(1)])}},n=new TextEncoder,a=e=>{throw Error(e)};var u=e=>{let t=0,i=[],l="";const o=(e,t)=>l&&([e,t]=l.split("="),i.push(t?[e,t]:e),l=""),r=()=>{for(let f,s;t<e.length;)if(f=e.charCodeAt(t),40===f)59===e.charCodeAt(t+1)?t=e.indexOf(";)",t)+2:(t++,(s=i).push(i=[]),r(),i=s);else if(59===f)t=e.indexOf("\n",t)+1;else if(f<=32)o(),t++;else{if(41===f)return o(),t++;l+=e[t++]}o()};return r(),i.length>1?i:i[0]},_=e=>(e="string"==typeof e?u(e):e,f(e));export{f as compile,_ as default,u as parse};